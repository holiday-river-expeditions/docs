# 2026-02-28 — Sanity CMS Integration

## What happened

Completed Phase 1 Sanity CMS setup. The website now has full Sanity integration: packages installed, Studio embedded, content schemas defined, and a typed client/query layer in place. All CI checks (lint, format, typecheck, test, build) pass.

## What was built

### Packages installed

- `sanity` v5 — Studio core
- `next-sanity` v12 — Next.js integration (`createClient`, `NextStudio`, `defineQuery`)
- `@sanity/vision` — GROQ playground inside Studio
- `@sanity/image-url` — Image URL builder for responsive images
- `@portabletext/react` — Portable Text renderer for rich text fields

### Configuration files

- `sanity.config.ts` — Studio config (basePath: `/studio`, structureTool, visionTool)
- `sanity.cli.ts` — CLI config for `sanity typegen`
- `sanity-typegen.json` — Typegen config (scans `src/**/*.{ts,tsx}`, outputs to `src/sanity/types.ts`)
- `src/sanity/env.ts` — Centralized env var access with empty-string fallbacks (safe for CI without secrets)

### Phase 1 schemas (`src/sanity/schemas/`)

| Schema         | Type     | Notes                                          |
| -------------- | -------- | ---------------------------------------------- |
| `river`        | document | Colorado, Green, San Juan, Yampa               |
| `activity`     | document | Rafting, Biking, Multi-Sport                   |
| `tripCategory` | document | Family, Stargazing, Canyon Concerts, etc.      |
| `trip`         | document | Core content + Arctic trip ID link             |
| `faq`          | document | Category + sort order for FAQ page             |
| `siteSettings` | document | Singleton: phone, email, address, social links |
| `page`         | document | Generic page builder                           |
| `heroBlock`    | object   | Hero section block (heading, image, CTA)       |
| `contentBlock` | object   | Rich text + image content block                |

_Deferred to later phases: Blog Post, Author, Story/History, Gallery Item._

### Sanity client utilities (`src/lib/sanity/`)

- `client.ts` — `createClient` from `next-sanity`
- `image.ts` — `urlFor()` helper
- `queries.ts` — GROQ queries using `defineQuery()` (type-safe, ready for `sanity typegen`)
- `fetch.ts` — Fetch helpers (`getAllTrips`, `getTripBySlug`, `getAllRivers`, `getAllFaqs`, `getSiteSettings`, `getPageBySlug`, etc.)
- `index.ts` — Barrel export

### Studio embedding

- `src/app/studio/[[...tool]]/page.tsx` — `NextStudio` client component
- `src/app/studio/[[...tool]]/layout.tsx` — Isolated layout (separate `<html>`/`<body>` to avoid root CSS conflicts)
- Studio accessible at `http://localhost:3000/studio` once env vars are set

### package.json

- Added `"typegen": "sanity typegen generate"` script

## Decisions made

- **Empty-string fallbacks in `env.ts`** rather than throwing on missing vars. This keeps CI green without requiring Sanity secrets in GitHub Actions. The client will fail at runtime if called without valid credentials, which is acceptable.
- **Phase 1 schemas only** — Blog Post, Author, Story/History, Gallery Item deferred to Phase 4 to keep scope focused.

## What's next

### Before Studio will work

1. Create a Sanity project at [sanity.io/manage](https://sanity.io/manage)
2. Copy `.env.example` → `.env.local`, fill in `NEXT_PUBLIC_SANITY_PROJECT_ID`, `NEXT_PUBLIC_SANITY_DATASET`, `SANITY_API_TOKEN`
3. Add the same vars to Vercel project settings and GitHub Actions secrets
4. Run `pnpm typegen` to generate TypeScript types from schemas (outputs `src/sanity/types.ts`, commit it)

### Remaining Phase 1 work

- Tailwind brand tokens (waiting on design sync with Ezra/Riley)
- Core layout: header, footer, navigation
- Component library basics (buttons, cards, section containers)

### Phase 3 (parallel)

- Create `hre-website` API client in Arctic admin (User level access)
- Store credentials in Vercel env vars
- Build typed Arctic API client in `src/lib/arctic/`

## Related

- [[build-phases]] — Phase 1 Sanity item can be checked off
- [[architecture]] — Content models now implemented
